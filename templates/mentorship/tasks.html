{% extends 'index.html' %}

{% block title %} Mentorship {% endblock %}

{% block content %}

<div>
    <legend>Tasks</legend>
    <form method="get" action="{% url 'get_tasks' %}">
        <fieldset>
            <div class="form-group">
                <input type="text" name="role" value="{{role}}" hidden>
                <input type="text" name="mentorship_id" value="{{mentorship_id}}" hidden>
            </div>
            <label for="status">Status</label>
            <select id="status" class="form-control" name="status">
                <option value="" selected>--Select--</option>
                {% for s in task_statuses %}
                <option value="{{s.key}}" {% if s.selected %} selected {% endif %}>{{s.val}}</option>
                {% endfor %}
            </select>
            <br>
            <button type="submit" class="btn btn-primary">Search</button>
        </fieldset>
    </form>
    {% if role == "mentor" %}
    <form method="post" action="{% url 'create_task' %}">
        {% csrf_token %}
        <fieldset>
            <div class="form-group">
                <input type="text" name="role" value="{{role}}" hidden>
                <input type="text" name="mentorship_id" value="{{mentorship_id}}" hidden>
            </div>
            <div class="form-group">
                <label for="title">Title</label>
                <input name="title" class="form-control" id="title" placeholder="title"/>
            </div>
            <div class="form-group">
                <label for="details">Details</label>
                <textarea name="detail" class="form-control" id="details" rows="3" placeholder="details..."></textarea>
            </div>
            <div class="form-group">
                <label for="start_date">Start Date</label><br>
                <input type="datetime-local" id="start_date" name="start_date" style="width: 100%;">
            </div>
            <div class="form-group">
                <label for="end_date">End Date</label>
                <br>
                <input type="datetime-local" id="end_date" name="end_date" style="width: 100%;">
            </div>
            <button type="submit" class="btn btn-info">Create</button>
        </fieldset>
    </form>
    {% endif %}
    <br><br>
    {% for task in tasks %}
    <div class="row" style="border-top: 1px solid gray; border-bottom: 1px solid gray; padding-top:2px">
        <div class="col-12 col-md-2 text-center" style="margin: auto;">
            {{task.title}}
        </div>
        <div class="col-12 col-md-7">
            <p style="text-decoration: solid;">{{ task.detail }}</p>
            From: {{task.start_time}} - To: {{task.end_time}}
        </div>
        <div class="col-12 col-md-1">
             {{task.task_status|title}}
        </div>
        <div class="col-12 col-md-2 text-center" style="margin:auto;">
                <!-- <input type="text" name="research_detail_id" id="" hidden value="{{research.id}}"/> -->
                <!-- <input type="text" name="status" id="change_status" hidden/> -->
                {% if role == 'mentor' %}
                    {% if task.status != 1 %}
                        <a href="{% url 'change_task_status' %}?status=1&task_id={{task.id}}&role={{role}}" class="btn btn-primary"><i class="bx bx-check"></i></a>
                        <a href="{% url 'change_task_status' %}?status=4&task_id={{task.id}}&role={{role}}" class="btn btn-danger"><i class="bx bx-x"></i></a>
                    {% else %}
                        <button class="btn btn-primary" disabled><i class="bx bx-check"></i></a>
                        <button class="btn btn-danger" disabled><i class="bx bx-x"></i></a>
                    {% endif %}
                {% else %}
                    {% if task.status == 2 %}
                        <a href="{% url 'change_task_status' %}?status=3&task_id={{task.id}}&role={{role}}" class="btn btn-info"><i class="bx bx-caret-right-circle"></i></a>
                    {% else %}
                        <button class="btn btn-info" disabled><i class="bx bx-caret-right-circle"></i></button>
                    {% endif %}
                {% endif %}
        </div>
    </div>
    {% endfor %}
    {% if not tasks %}
    <br><br>
    <p>No tasks to show...</p>
    {% endif %}
</div>
{% endblock %}